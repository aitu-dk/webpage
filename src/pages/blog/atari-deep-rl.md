---
layout: ../../layouts/BlogLayout.astro
slug: atari-deep-rl
title: Playing Atari with Deep Reinforcement Learning
description:
authors:
  - Marcel Rosier
  - Ludek Cizinsky
format: blog
tags:
  - reinforcement-learning
  - games
image:
  src: /posts/atari-deep-rl/atari.jpg
  alt: Atari
published: 03/08/2023
---

Hello there! This week we switch domains and take our first leap into the exciting world of **Reinforcement learning** (RL) by diving into DeepMinds' ground breaking classic ["Playing Atari with Deep Reinforcement Learning"](https://arxiv.org/abs/1312.5602) (2013). It was the first successfull application of Deep Learning to RL and outperformed SOTA methods and partly even humans at a selection of ATARI games.

## Playing Atari with Deep Reinforcement Learning

---

<br/>

üìç **Background**. After the initial success of deep neural networks, especially convolutional neural networks in Computer Vision problems, this paper was the first to demonstrate their applicability to reinforcement learning. The model - a deep Q Network - learns purely from pixel input to play seven Atari games and outperforms even baselines that utilize heavily hand-crafted and fine-tuned features. This paper set the basis for the entire field of deep reinforcement learning and established DeepMind as one of the leading AI companies in the world.

<br/>

ü§ñ **What's reinforcement learning?** RL is a machine learning training method based on rewarding desired behaviors and/or punishing undesired ones. A typical setting consists of an agent interacting with an environment. The agent can perform actions to influence the environment and receives a state and a reward (indicating if the action was good or bad) in return. The central task is then to find actions that maximize the total reward the agent can obtain. One way to learn how to choose actions is Q-Learning.  
<br/>

üá∂ **Deep Q-Learning**.  
**Q-Learning**. Q-Learning attempts to learn optimal actions by defining a function _Q(s,a) = R_ that approximates the total reward _R_ a player can obtain until **the end** of the game given a current state _s_ and action _a_. When the Q function is modeled as a deep neural network (here a CNN) the approach is called Deep Q-Learning.  
**Data**. As every other neural net we need data to train the model. In the case of RL this can be obtained on the fly (online learning), meaning that the data is generated by playing while the model is trained and stored in a buffer. This buffer consists of transitions _(s,a,r,s')_ that capture how an action _a_ in a state _s_ leads to an immediate reward _r_ and subsequent state _s'_.  
**Optimization**. To optimize the model we need to define a loss function that instructs the network how to change in order to better approximate our desired Q-function. We can obtain a Loss function by decomposing our Q-function. By definition the following equation holds:
_Q(s,a) = R = r + Q(s',a')_.  
In words: The Q value (output of the Q function) for the current state should be the same as the immediate reward _r_ (we get for performing _a_ in _s_) plus the Q value for the next state _s'_. We can use this fact and define _Q(s,a)_ as our prediciton and _r + Q(s',a')_ as our ground truth label.  
**Adapted Q function**. By default the Q function takes in a state-action pair and outputs a single Q value. When applying this to a deep neural network, it would require us to run an inference for every possible action in a state. This scales linearly with the number of available actions and quickly becomes computationally expensive. A more efficent way to model this, is to merge it into a single model by adapting the Q function to take in a state and output a list of action-Qvalue pairs.

<br>

üìà **Training algorithm**.
The training is conceptually split into 2 parts: Playing and Learning.
During the playing phase we select and perform an action and store the resulting transition in our replay buffer for future use. In the Learning part we randomly sample a minibatch from our buffer and perform a gradient descent step. The random sampling is important to smooth the training distribution and overcome the strong correlation between consecutive transitions in a game (this technique is referred to as experience replay).
<img src="/posts/atari-deep-rl/algorithm.png" alt="Pseudo code for the training algorithm" style="display:block;margin-left:auto;margin-right:auto;width:65%"/>

<br>

**Model architecture**.
Judged by todays standard, the model is astonishingly simple.
It takes an 84 √ó 84 √ó 4 image produced by a preprocessing function (downsampling, cropping, gray-scaling, stacking 4 images) and feeds it through two convolutional and two linear layers with ReLU's inbetween. The number of output neurons corresponds to the number of valid actions, which varies between 4 and 18 for the evaluated corpus of games (Figure adapted from [here](https://github.com/msinto93/DQN_Atari)).
<img src="/posts/atari-deep-rl/model.png" alt="Model architecture" style="display:block;margin-left:auto;margin-right:auto;width:65%"/>

**Results**
The model outperforms SOTA methods on most games and can even beat human players in three of them.
This is especially impressive when considering that previous SOTA approaches used highly game specific information to make predicitions while the Deep Q Network learns from nothing but the pixel input.
Notabily humans are superior to the model in games that have a longer playing time. Intuitively this makes sense, given that the core task of the network - to approximate the Q function that returns the estimated reward until the end of the game - becomes more difficult with increasing game length.
<img src="/posts/atari-deep-rl/results.png" alt="Results table" style="display:block;margin-left:auto;margin-right:auto;width:65%"/>

### üîÆ Key Takeaways

---

<br/>

**üòç DL in RL!** The paper demonstrated that it is possible to combine deep learning with reinforcement learning and thereby opened the door for a lot of research and applications.

<br/>

üß† **Simplicity.** Even small models can produce impressive results. Not every use-case requries huge models with billions of parameters.

<br/>

### üì£ Stay in touch

---

That's it for this week. We hope you enjoyed reading this post. üòä To stay updated about our activities, make sure you give us a follow on [LinkedIn](https://www.linkedin.com/company/aitu-dk/) and [Subscribe to our Newsletter](https://aitu.group/#newsletter). Any questions or ideas for talks, collaboration, etc.? Drop us a message at [hello@aitu.group](mailto:hello@aitu.group).
